FROM microsoft/aspnetcore:2.0 AS base
WORKDIR /app
EXPOSE 80

FROM microsoft/aspnetcore-build:2.0 AS build
WORKDIR /src
COPY apiApp/apiApp.csproj apiApp/
RUN dotnet restore apiApp/apiApp.csproj
COPY . .
WORKDIR /src/apiApp
RUN dotnet build apiApp.csproj -c Release -o /app

FROM build AS publish
RUN dotnet publish apiApp.csproj -c Release -o /app

FROM base AS final
ENV Authorization="Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJkZWZhdWx0Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZWNyZXQubmFtZSI6ImFwaXVzZXItdG9rZW4tNnp2aHgiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoiYXBpdXNlciIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6ImJiMTViZWNkLTczNzgtMTFlOC05YTFiLTFhMGZlZTI3M2JmNiIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDpkZWZhdWx0OmFwaXVzZXIifQ.PhCJaDx7gMm88shFnhAQbR-YdEy3ncqDUnk9tz652yxhCiJtKpn_ZPsmsMNEWuPipIUch9y1ob6vTp1-p0EV1aHZ8vhlXqK7Ctlvk0I_W1S21RNjsq_C7pnJZTU0TJ6YgtMlYIQIiUa4A3BnAVldEHmjxYpnv9mamNlwvLn2r-FcszR0MQvh9wxqKMJMKkTo9jaiAhvra1rePmjtyJJg4QLcf0dNOJB-kGhp9CoaM-JYGbgvM9OWsKOlZ6kJsqSUxKGzeD-gToxr6Ai191Iahko_F0fJhgNpZc0yAxkx0urI2lPc_RM01t243hE8bxbZeMlA5ZqDGbFb39oRwa3BF7nWO3NFxQPj0HRvONnuwiZZGGx6kHTKeeBOC1rPU1qBZR7MAgZDSMpkefnTJxl9bO_bys6yLqZiVdSgchpgGalZzOG0qSZ7zqu0zR5DrSm9ISh2a31h86EnNQe_gcswGfhYbop-43C8jJJ8LNL5oKCWM8i2MgodwAS9ArPWgGW7T4e9udh7WDA6xyWLkyLPO0j5OAXKdlE_oxlSAu7xYci-vGaISCAcJNxPOKmqqiaCVA1NEdR5asPllL_DcQP5GGg9XxaYVLPEfa2koVc5J0XRSSpt4kBHFdqBCSKVzdRUzDw6Eioi0sEQXpAJ0pBFdfTLWhkTeseFvGN_qSo8ZBk"
WORKDIR /app
COPY --from=publish /app .
ENTRYPOINT ["dotnet", "apiApp.dll"]
